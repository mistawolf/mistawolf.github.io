function update(){for(requestAnimationFrame(update),fraqByteData=new Uint8Array(analyser.frequencyBinCount),analyser.getByteFrequencyData(fraqByteData),min=256,max=0,lowb=0,i=0;i<fraqByteData.length;i++)fraqByteData[i]>max?max=fraqByteData[i]:fraqByteData[i]<min&&fraqByteData[i]>0&&(min=fraqByteData[i]);for(max/=4,rand=fraqByteData[Math.floor(Math.random()*fraqByteData.length+64)],style="",max>40?style+=".glitch::after{    clip: rect("+-rand+"px, 450px, "+Math.floor(Math.random()*max)+"px, 0);}":style+=".glitch::before{    clip: rect(0px, 450px, 0px, 0px);}.glitch::after{ clip: rect(0px, 450px, 0px, 0px);}",$("#toggleGlitch").html()!=style&&$("#toggleGlitch").html(style),ctx.clearRect(0,0,canvas.width,canvas.height),i=0;i<10;i++)mline_posy=canvas.height-mLine-fraqByteData[10*i]/3,mline_posy<10&&(mline_posy=10),ctx.fillstyle="black",ctx.fillRect(Math.floor(canvas.width/10)*i,mline_posy,Math.floor(canvas.width/10),mLine)}var analyser,style,canvas,ctx,fraqByteData,mLine=5,current=0,len=6,a,m,mute=!1,mline_posy=0;window.onload=function(){canvas=document.getElementById("musicVis"),ctx=canvas.getContext("2d"),a=document.getElementById("audio"),document.getElementById("music"),m=Math.floor(Math.random()*len),a.src="music/"+m+".mp3",a.controls="false",a.autoplay="true",a.load(),a.play();var b=new AudioContext;analyser=b.createAnalyser(),b.createMediaElementSource(a).connect(analyser),analyser.connect(b.destination),a.play(),update()};var audio=document.getElementById("audio");audio.addEventListener("ended",function(a){current=Math.floor(Math.random()*len),current>=len&&(current=0),audio.src="music/"+current+".mp3",audio.load(),audio.play()});var volumeDrag=!1;$(".volume,.volumeBar").on("mousedown",function(b){volumeDrag=!0,a.muted=!1,$(".audio").removeClass("muted"),updateVolume(b.pageX)}),$(document).on("mouseup",function(a){volumeDrag&&(volumeDrag=!1,updateVolume(a.pageX))}),$(document).on("mousemove",function(a){volumeDrag&&updateVolume(a.pageX)});var updateVolume=function(b,c){var e,d=$(".volume");if(c)e=100*c;else{e=100*(b-d.offset().left)/d.width()}e>100&&(e=100),e<0&&(e=0),$(".volume").css("clip","rect(0px, "+e+"px, 50px, 0px)"),a.volume=e/100,0==a.volume?$(".audio").removeClass("sound2").addClass("muted"):a.volume>.5?$(".audio").removeClass("muted").addClass("sound2"):$(".audio").removeClass("muted").removeClass("sound2")};